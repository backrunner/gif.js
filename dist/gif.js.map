{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/events/events.js","src/browser.coffee","src/gif.coffee"],"names":["f","exports","module","define","amd","g","window","global","self","this","GIF","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","EventEmitter","_events","_maxListeners","undefined","prototype","defaultMaxListeners","setMaxListeners","isNumber","isNaN","TypeError","emit","type","er","handler","len","args","listeners","error","isObject","arguments","err","context","isUndefined","isFunction","Array","slice","apply","addListener","listener","m","newListener","push","warned","console","trace","on","once","fired","removeListener","list","position","splice","removeAllListeners","key","ret","listenerCount","evlistener","emitter","arg","UA","browser","mode","platform","ua","navigator","userAgent","toLowerCase","match","document","documentMode","name","version","parseFloat","parseInt","extend","child","parent","hasProp","ctor","constructor","__super__","superClass","defaults","frameDefaults","workerScript","workers","repeat","background","quality","width","height","transparent","debug","dither","delay","copy","dispose","options","base","value","running","frames","freeWorkers","activeWorkers","setOptions","setOption","_canvas","results","addFrame","image","frame","prevFrame","ImageData","data","CanvasRenderingContext2D","WebGLRenderingContext","getContextData","childNodes","apng","getImageData","disposeOp","cache","getImageCache","render","j","numWorkers","ref","nextFrame","finishedFrames","imageParts","spawnWorkers","globalPalette","renderNextFrame","abort","worker","shift","log","terminate","Math","min","forEach","_this","Worker","onmessage","event","indexOf","frameFinished","index","finishRendering","k","l","len1","len2","len3","offset","page","ref1","ref2","pageSize","cursor","round","Uint8Array","set","Blob","task","getTask","postMessage","ctx","frameOptions","useFrameSize","imgData","threshold","left","top","getContext","createElement","clearRect","fillStyle","fillRect","putImageData","blendOp","drawImage","last","canTransfer"],"mappings":"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","sourceRoot":"","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","### CoffeeScript version of the browser detection from MooTools ###\r\n\r\nua = navigator.userAgent.toLowerCase()\r\nplatform = navigator.platform.toLowerCase()\r\nUA = ua.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/) or [null, 'unknown', 0]\r\nmode = UA[1] == 'ie' && document.documentMode\r\n\r\nbrowser =\r\n  name: if UA[1] is 'version' then UA[3] else UA[1]\r\n  version: mode or parseFloat(if UA[1] is 'opera' && UA[4] then UA[4] else UA[2])\r\n\r\n  platform:\r\n    name: if ua.match(/ip(?:ad|od|hone)/) then 'ios' else (ua.match(/(?:webos|android)/) or platform.match(/mac|win|linux/) or ['other'])[0]\r\n\r\nbrowser[browser.name] = true\r\nbrowser[browser.name + parseInt(browser.version, 10)] = true\r\nbrowser.platform[browser.platform.name] = true\r\n\r\nmodule.exports = browser\r\n","{EventEmitter} = require 'events'\r\nbrowser = require './browser.coffee'\r\n\r\nclass GIF extends EventEmitter\r\n\r\n  defaults =\r\n    workerScript: 'gif.worker.js'\r\n    workers: 2\r\n    repeat: 0 # repeat forever, -1 = repeat once\r\n    background: '#fff'\r\n    quality: 10 # pixel sample interval, lower is better\r\n    width: null # size derermined from first frame if possible\r\n    height: null\r\n    transparent: null\r\n    debug: false\r\n    dither: false # see GIFEncoder.js for dithering options\r\n\r\n  frameDefaults =\r\n    delay: 500 # ms\r\n    copy: false\r\n    dispose: -1\r\n\r\n  constructor: (options) ->\r\n    @running = false\r\n\r\n    @options = {}\r\n    @frames = []\r\n\r\n    @freeWorkers = []\r\n    @activeWorkers = []\r\n\r\n    @setOptions options\r\n    for key, value of defaults\r\n      @options[key] ?= value\r\n\r\n  setOption: (key, value) ->\r\n    @options[key] = value\r\n    if @_canvas? and key in ['width', 'height']\r\n      @_canvas[key] = value\r\n\r\n  setOptions: (options) ->\r\n    @setOption key, value for own key, value of options\r\n\r\n  addFrame: (image, options={}) ->\r\n    frame = {}\r\n    frame.transparent = @options.transparent\r\n    frame.options = options\r\n    for key of frameDefaults\r\n      frame[key] = options[key] or frameDefaults[key]\r\n\r\n    # use the images width and height for options unless already set\r\n    @setOption 'width', image.width unless @options.width?\r\n    @setOption 'height', image.height unless @options.height?\r\n\r\n    if ImageData? and image instanceof ImageData\r\n       frame.data = image.data\r\n    else if (CanvasRenderingContext2D? and image instanceof CanvasRenderingContext2D) or (WebGLRenderingContext? and image instanceof WebGLRenderingContext)\r\n      if options.copy\r\n        frame.data = @getContextData image\r\n      else\r\n        frame.context = image\r\n    else if image.childNodes?\r\n      if options.apng\r\n        prevFrame = null\r\n        if @frames.length\r\n          prevFrame = @frames[@frames.length - 1]\r\n        frame.data = @getImageData image, options, prevFrame\r\n        if options.disposeOp is 2\r\n          frame.cache = @getImageCache options\r\n      else\r\n        if options.copy\r\n          frame.data = @getImageData image\r\n        else\r\n          frame.image = image\r\n    else\r\n      throw new Error 'Invalid image'\r\n\r\n    @frames.push frame\r\n\r\n  render: ->\r\n    throw new Error 'Already running' if @running\r\n\r\n    if not @options.width? or not @options.height?\r\n      throw new Error 'Width and height must be set prior to rendering'\r\n\r\n    @running = true\r\n    @nextFrame = 0\r\n    @finishedFrames = 0\r\n\r\n    @imageParts = (null for i in [0...@frames.length])\r\n    numWorkers = @spawnWorkers()\r\n    # we need to wait for the palette\r\n    if @options.globalPalette == true\r\n      @renderNextFrame()\r\n    else\r\n      @renderNextFrame() for i in [0...numWorkers]\r\n\r\n    @emit 'start'\r\n    @emit 'progress', 0\r\n\r\n  abort: ->\r\n    loop\r\n      worker = @activeWorkers.shift()\r\n      break unless worker?\r\n      @log 'killing active worker'\r\n      worker.terminate()\r\n    @running = false\r\n    @emit 'abort'\r\n\r\n  # private\r\n\r\n  spawnWorkers: ->\r\n    numWorkers = Math.min(@options.workers, @frames.length)\r\n    [@freeWorkers.length...numWorkers].forEach (i) =>\r\n      @log \"spawning worker #{ i }\"\r\n      worker = new Worker @options.workerScript\r\n      worker.onmessage = (event) =>\r\n        @activeWorkers.splice @activeWorkers.indexOf(worker), 1\r\n        @freeWorkers.push worker\r\n        @frameFinished event.data\r\n      @freeWorkers.push worker\r\n    return numWorkers\r\n\r\n  frameFinished: (frame) ->\r\n    @log \"frame #{ frame.index } finished - #{ @activeWorkers.length } active\"\r\n    @finishedFrames++\r\n    @emit 'progress', @finishedFrames / @frames.length\r\n    @imageParts[frame.index] = frame\r\n    # remember calculated palette, spawn the rest of the workers\r\n    if @options.globalPalette == true\r\n      @options.globalPalette = frame.globalPalette\r\n      @log 'global palette analyzed'\r\n      @renderNextFrame() for i in [1...@freeWorkers.length] if @frames.length > 2\r\n    if null in @imageParts\r\n      @renderNextFrame()\r\n    else\r\n      @finishRendering()\r\n\r\n  finishRendering: ->\r\n    len = 0\r\n    for frame in @imageParts\r\n      len += (frame.data.length - 1) * frame.pageSize + frame.cursor\r\n    len += frame.pageSize - frame.cursor\r\n    @log \"rendering finished - filesize #{ Math.round(len / 1000) }kb\"\r\n    data = new Uint8Array len\r\n    offset = 0\r\n    for frame in @imageParts\r\n      for page, i in frame.data\r\n        data.set page, offset\r\n        if i is frame.data.length - 1\r\n          offset += frame.cursor\r\n        else\r\n          offset += frame.pageSize\r\n\r\n    image = new Blob [data],\r\n      type: 'image/gif'\r\n\r\n    @emit 'finished', image, data\r\n\r\n  renderNextFrame: ->\r\n    throw new Error 'No free workers' if @freeWorkers.length is 0\r\n    return if @nextFrame >= @frames.length # no new frame to render\r\n\r\n    frame = @frames[@nextFrame++]\r\n    worker = @freeWorkers.shift()\r\n    task = @getTask frame\r\n\r\n    @log \"starting frame #{ task.index + 1 } of #{ @frames.length }\"\r\n    @activeWorkers.push worker\r\n    worker.postMessage task#, [task.data.buffer]\r\n\r\n  getContextData: (ctx, frameOptions, useFrameSize) ->\r\n    if useFrameSize\r\n      imgData = ctx.getImageData(frame.left, frame.top, frame.width, frame.height)\r\n    else\r\n      imgData = ctx.getImageData(0, 0, @options.width, @options.height).data\r\n    if frameOptions?.transparent\r\n      threshold = 128\r\n      for i in [0...imgData.length] by 4\r\n        imgData[i + 3] = 255 * (imgData[i + 3] > threshold)\r\n\r\n    return imgData\r\n\r\n  getImageCache: (options) ->\r\n    ctx = @_canvas.getContext '2d'\r\n    return @getContextData ctx, options, true\r\n\r\n  getImageData: (image, frameOptions, prevFrame) ->\r\n    if not @_canvas?\r\n      @_canvas = document.createElement 'canvas'\r\n      @_canvas.width = @options.width\r\n      @_canvas.height = @options.height\r\n\r\n    ctx = @_canvas.getContext '2d'\r\n\r\n    if @frames.length is 0\r\n      ctx.clearRect 0, 0, @options.width, @options.height\r\n      ctx.fillStyle = @options.background\r\n      ctx.fillRect frameOptions.left, frameOptions.top, frameOptions.width, frameOptions.height\r\n\r\n    if prevFrame?.options.disposeOp is 1\r\n      ctx.clearRect prevFrame.options.left, prevFrame.options.top,\r\n        prevFrame.options.width, prevFrame.options.height\r\n      ctx.fillStyle = @options.background\r\n      ctx.fillRect prevFrame.options.left, prevFrame.options.top,\r\n        prevFrame.options.width, prevFrame.options.height\r\n\r\n    if prevFrame?.options.disposeOp is 2\r\n      ctx.putImageData prevFrame.cache, prevFrame.options.left, prevFrame.options.top\r\n\r\n    if frameOptions?.blendOp is 0\r\n      ctx.clearRect frameOptions.left, frameOptions.top, frameOptions.width, frameOptions.height\r\n      ctx.fillStyle = @options.background\r\n      ctx.fillRect frameOptions.left, frameOptions.top, frameOptions.width, frameOptions.height\r\n    else\r\n      ctx.clearRect 0, 0, @options.width, @options.height\r\n      ctx.fillStyle = @options.background\r\n      ctx.fillRect 0, 0, @options.width, @options.height\r\n    ctx.drawImage image, frameOptions?.left or 0, frameOptions?.top or 0\r\n\r\n    return @getContextData ctx, frameOptions\r\n\r\n  getTask: (frame) ->\r\n    index = @frames.indexOf frame\r\n    task =\r\n      index: index\r\n      last: index is (@frames.length - 1)\r\n      delay: frame.delay\r\n      dispose: frame.dispose\r\n      transparent: frame.transparent\r\n      width: @options.width\r\n      height: @options.height\r\n      quality: @options.quality\r\n      dither: @options.dither\r\n      globalPalette: @options.globalPalette\r\n      repeat: @options.repeat\r\n      canTransfer: (browser.name is 'chrome')\r\n\r\n    if frame.data?\r\n      task.data = frame.data\r\n    else if frame.context?\r\n      task.data = @getContextData frame.context\r\n    else if frame.image?\r\n      task.data = @getImageData frame.image\r\n    else\r\n      throw new Error 'Invalid frame'\r\n\r\n    return task\r\n\r\n  log: (args...) ->\r\n    return unless @options.debug\r\n    console.log args...\r\n\r\n\r\nmodule.exports = GIF\r\n"]}